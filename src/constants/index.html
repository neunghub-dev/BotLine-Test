<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      const inputArray = [
        {
          id: 10,
          roundId: 47,
          userId: 1,
          isDeduction: true,
          ka: "k3",
          unit: 10,
          createdAt: "2023-11-25T17:54:09.000Z",
          updatedAt: "2023-11-25T17:54:09.000Z",
        },
        {
          id: 11,
          roundId: 47,
          userId: 1,
          isDeduction: true,
          ka: "k1",
          unit: 1,
          createdAt: "2023-11-25T17:54:18.000Z",
          updatedAt: "2023-11-25T17:54:18.000Z",
        },
        {
          id: 19,
          roundId: 47,
          userId: 1,
          isDeduction: true,
          ka: "k1",
          unit: 12,
          createdAt: "2023-11-25T17:54:18.000Z",
          updatedAt: "2023-11-25T17:54:18.000Z",
        },
        {
          id: 12,
          roundId: 47,
          userId: 2,
          isDeduction: true,
          ka: "k1",
          unit: 1,
          createdAt: "2023-11-25T17:54:36.000Z",
          updatedAt: "2023-11-25T17:54:36.000Z",
        },
      ];

      function convertArray(inputArray) {
        const outputArray = [];

        inputArray.forEach((item) => {
          const existingObject = outputArray.find(
            (obj) => obj.id === item.userId
          );

          if (existingObject) {
            const playIndex = existingObject.play.findIndex(
              (playItem) => playItem.name === item.ka
            );

            if (playIndex !== -1) {
              existingObject.play[playIndex].unit += item.unit;
              existingObject.play[playIndex].isDeduction = item.isDeduction;
            }
          } else {
            const newObject = {
              id: item.userId,
              play: [
                { name: "k1", unit: 0, balance: 0, isDeduction: false },
                { name: "k2", unit: 0, balance: 0, isDeduction: false },
                { name: "k3", unit: 0, balance: 0, isDeduction: false },
                { name: "k4", unit: 0, balance: 0, isDeduction: false },
                { name: "k5", unit: 0, balance: 0, isDeduction: false },
                { name: "k6", unit: 0, balance: 0, isDeduction: false },
              ],
              unit: 0,
              total: 0,
            };

            const playIndex = newObject.play.findIndex(
              (playItem) => playItem.name === item.ka
            );
            if (playIndex !== -1) {
              newObject.play[playIndex].unit += item.unit;
              newObject.play[playIndex].isDeduction = item.isDeduction;
            }

            outputArray.push(newObject);
          }
        });
        outputArray.forEach((obj) => {
          obj.total = obj.play.reduce(
            (sum, playItem) => sum + playItem.unit,
            0
          );
        });
        return outputArray;
      }

      const results = convertArray(inputArray);
      console.log(results);

      const result = convertArray(inputArray);
      console.log(result);
      const text = "This is an example = using characters = in JavaScript.";

      if (matches) {
        console.log("Found the following occurrences of '=' or '/':");
        console.log(matches);
      } else {
        console.log("Neither '=' nor '/' found in the text");
      }

      //pok 9*2  = 999
      //pok 9*1 = 998
      //pok 8*2 = 997
      //pok 8*1 = 996
      //pok 7.5*2 = 995
      //pok 7.5*1 = 994
      //pok 7*1 = 993
      //pok 6*1 = 992
      //pok 5*1 = 991
      //pok 4*1 = 990
      //pok 3*1 = 989
      //pok 2*2 = 987
      //pok 2*1 = 986
      //pok 1*1 = 985
      //pok 0*1 = 984

      const data = [
        {
          name: "k0",
          number: 997,
          isLeader: true,
          status: "",
          isPok: false,
        },
        {
          name: "k1",
          number: 989,
          isLeader: false,
          status: "",
          isPok: false,
        },
        {
          name: "k2",
          number: 998,
          isLeader: false,
          status: "",
          isPok: false,
        },
        {
          name: "k3",
          number: 997,
          isLeader: false,
          status: "",
          isPok: false,
        },
        {
          name: "k4",
          number: 999,
          isLeader: false,
          status: "",
          isPok: false,
        },
        {
          name: "k5",
          number: 999,
          isLeader: false,
          status: "",
          isPok: false,
        },
        {
          name: "k6",
          number: 990,
          isLeader: false,
          status: "",
          isPok: false,
        },
      ];

      let isWinnerExists = false;

      for (const item of data) {
        if (!item.isLeader) {
          if (item.number > data[0].number) {
            item.status = "winner";
            console.log(item.number);
            if (
              item.number === 999 ||
              item.number === 997 ||
              item.number === 995 ||
              item.number === 987
            ) {
              item.isPok = true;
            }
            console.log(item.isPok);
          } else if (item.number === data[0].number) {
            item.status = "draw";
          } else {
            if (
              data[0].number === 999 ||
              data[0].number === 997 ||
              data[0].number === 995 ||
              data[0].number === 987
            ) {
              item.isPok = true;
            }
            item.status = "loser";
          }
        } else {
          continue;
        }
      }

      console.log(data);

      const user = [
        {
          id: 1,
          play: [
            {
              name: "k1",
              unit: 22,
              balance: 0,
              isDeduction: true,
            },
            {
              name: "k2",
              unit: 34,
              balance: 0,
              isDeduction: true,
            },
            {
              name: "k3",
              unit: 46,
              balance: 0,
              isDeduction: true,
            },
            {
              name: "k4",
              unit: 66,
              balance: 0,
              isDeduction: true,
            },
            {
              name: "k5",
              unit: 22,
              balance: 0,
              isDeduction: true,
            },
            {
              name: "k6",
              unit: 10,
              balance: 0,
              isDeduction: true,
            },
          ],
          unit: 0,
          total: 0,
        },
        {
          id: 2,
          play: [
            {
              name: "k1",
              unit: 32,
              balance: 0,
              isDeduction: false,
            },
            {
              name: "k2",
              unit: 0,
              balance: 0,
              isDeduction: false,
            },
            {
              name: "k3",
              unit: 0,
              balance: 0,
              isDeduction: false,
            },
            {
              name: "k4",
              unit: 34,
              balance: 0,
              isDeduction: false,
            },
            {
              name: "k5",
              unit: 20,
              balance: 0,
              isDeduction: false,
            },
            {
              name: "k6",
              unit: 123,
              balance: 0,
              isDeduction: false,
            },
          ],
          unit: 0,
          total: 0,
        },
      ];

      console.log(user);

      data.forEach((e) => {
        user.forEach((item) => {
          item.play.forEach((play) => {
            if (e.name === play.name) {
              if (e.status === "winner") {
                if (e.isPok === true) {
                  if (play.isDeduction) {
                    play.balance = play.unit * 2 + play.unit;
                    item.total += play.balance;
                    item.unit += play.unit;
                  } else {
                    play.balance = play.unit * 2;
                    item.total += play.balance;
                    item.unit += play.unit;
                  }
                } else {
                  play.balance = play.unit / 2 + play.unit;
                  item.total += play.balance;
                  item.unit += play.unit;
                }
              } else if (e.status === "loser") {
                if (e.isPok === true) {
                  if (play.isDeduction) {
                    play.balance = 0;
                    item.total += play.balance;
                    item.unit += play.unit;
                  } else {
                    play.balance = 0;
                    item.total += play.balance;
                    item.unit += play.unit;
                  }
                } else {
                  if (e.isPok === true) {
                    if (play.isDeduction) {
                      play.balance = play.unit / 2;
                      item.total += play.balance;
                      item.unit += play.unit;
                    } else {
                      play.balance = 0;
                      item.total += play.balance;
                      item.unit += play.unit;
                    }
                  }
                }
              } else {
                play.balance = play.unit;
                item.total += play.balance;
                item.unit += play.unit;
              }
            }
          });
        });
      });

      console.log(user);
    </script>
  </body>
</html>
